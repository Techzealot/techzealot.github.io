<!doctype html><html class=no-js lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Mysql事务 - 个人博客</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="Mysql事务"><meta property="og:description" content="mysql事务详解 本文所有讨论皆是针对innodb存储引擎
锁 锁分类 表锁模式兼容矩阵
InnoDB锁分类
InnoDB锁关系矩阵
行锁算法 不同索引加锁行为分析 InnoDB存储引擎的行锁是通过锁住索引实现的，而不是记录"><meta property="og:type" content="article"><meta property="og:url" content="https://techzealot.github.io/posts/mysql%E4%BA%8B%E5%8A%A1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-03T17:57:34+08:00"><meta property="article:modified_time" content="2023-04-03T17:57:34+08:00"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title=个人博客 rel=home><div class="logo__item logo__text"><div class=logo__title>个人博客</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>首页</span></a></li><li class=menu__item><a class=menu__link href=/categories><span class=menu__text>分类</span></a></li><li class=menu__item><a class=menu__link href=/tags><span class=menu__text>标签</span></a></li><li class=menu__item><a class=menu__link href=/about><span class=menu__text>关于</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Mysql事务</h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>techzealot</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2023-04-03T17:57:34+08:00>2023-04-03</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/mysql/ rel=category>mysql</a>, <a class=meta__link href=/categories/%E4%BA%8B%E5%8A%A1/ rel=category>事务</a>, <a class=meta__link href=/categories/%E9%94%81/ rel=category>锁</a></span></div></div></header><div class="post__toc toc"><div class=toc__title>目录</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#锁>锁</a><ul><li><a href=#锁分类>锁分类</a></li><li><a href=#行锁算法>行锁算法</a></li><li><a href=#不同索引加锁行为分析>不同索引加锁行为分析</a></li></ul></li><li><a href=#死锁>死锁</a></li><li><a href=#mvcc>MVCC</a><ul><li><a href=#当前读>当前读</a></li><li><a href=#快照读>快照读</a></li></ul></li><li><a href=#一致性视图consistent-read-view>一致性视图(consistent read view)</a><ul><li><a href=#定义>定义</a></li><li><a href=#获取方式及时机>获取方式及时机</a></li><li><a href=#工作原理>工作原理</a></li></ul></li><li><a href=#事务定义>事务定义</a></li><li><a href=#事务特性acid>事务特性：ACID</a><ul><li><a href=#原子性>原子性</a></li><li><a href=#一致性>一致性</a></li><li><a href=#隔离性>隔离性</a></li><li><a href=#持久性>持久性</a></li></ul></li><li><a href=#事务开启与提交模式>事务开启与提交模式</a></li><li><a href=#事务隔离级别>事务隔离级别</a><ul><li><a href=#读未提交>读未提交</a></li><li><a href=#读已提交>读已提交</a></li><li><a href=#可重复读>可重复读</a></li><li><a href=#串行化>串行化</a></li></ul></li><li><a href=#事务隔离级别实现原理>事务隔离级别实现原理</a><ul><li><a href=#读未提交-1>读未提交</a></li><li><a href=#读已提交-1>读已提交</a></li><li><a href=#可重复读-1>可重复读</a></li><li><a href=#串行化-1>串行化</a></li></ul></li></ul></nav></div></div><div class="content post__content clearfix"><h1 id=mysql事务详解>mysql事务详解</h1><p>本文所有讨论皆是针对innodb存储引擎</p><h2 id=锁>锁</h2><h3 id=锁分类>锁分类</h3><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412165006968.png alt=image-20230412165006968></p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412165120820.png alt=image-20230412165120820></p><p>表锁模式兼容矩阵</p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412165240014.png alt=image-20230412165240014></p><p>InnoDB锁分类</p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412165348218.png alt=image-20230412165348218></p><p>InnoDB锁关系矩阵</p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412170012526.png alt=image-20230412170012526></p><h3 id=行锁算法>行锁算法</h3><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412170207658.png alt=image-20230412170207658></p><h3 id=不同索引加锁行为分析>不同索引加锁行为分析</h3><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412170342551.png alt=image-20230412170342551></p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412170745081.png alt=image-20230412170745081></p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412170820430.png alt=image-20230412170820430></p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412170858462.png alt=image-20230412170858462></p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412171026995.png alt=image-20230412171026995></p><p>InnoDB存储引擎的行锁是通过锁住索引实现的，而不是记录</p><p>由于InnoDB特殊的索引机制，数据库操作使用主键索引时，InnoDB会锁住主键索引；使用非主键索引时，InnoDB会先锁住非主键索引，再锁定主键索引</p><h2 id=死锁>死锁</h2><p>死锁产生的四个条件</p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412171650533.png alt=image-20230412171650533></p><p>如何避免死锁的产生</p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412171806769.png alt=image-20230412171806769></p><p>InnoDB死锁优化</p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412173905750.png alt=image-20230412173905750></p><h2 id=mvcc>MVCC</h2><p>只在RC和RR隔离级别生效</p><p>读不加锁，读写不冲突</p><p>在MVCC并发控制下，读操作分为快照读与当前读</p><p>实现方式：</p><p>隐藏字段+undolog链</p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412163111895.png alt=image-20230412163111895></p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412163207214.png alt=image-20230412163207214></p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412163230785.png alt=image-20230412163230785></p><p><strong>DB_TRX_ID</strong>: 6字节事务id字段，表示最后更新的事务id(update,delete,insert)。
此外，删除在内部被视为更新，其中行中的特殊位被设置为将其标记为已软删除。</p><p><strong>DB_ROLL_PTR</strong>: 7字节回滚指针，指向前一个版本的undolog记录，组成undo链表。如果更新了行，则撤消日志记录包含着更新行之前重建行内容所需的信息。</p><p><strong>DB_ROW_ID</strong>: 6字节的DB_ROW_ID字段，包含一个随着新行插入而单调递增的行ID, 当由innodb自动产生聚集索引时，聚集索引会包括这个行ID的值，否则这个行ID不会出现在任何索引中。</p><h3 id=当前读>当前读</h3><p>当前读，读取的是最新版本，并且对读取的记录加锁，阻塞其他事务同时改动相同记录，避免出现安全问题</p><p>属于当前读的SQL形式：</p><ul><li>select&mldr;for share (共享读锁)</li><li>select&mldr;for update</li><li>update , delete , insert</li></ul><p>关于for update：</p><p>利用select * for update 可以锁表/锁行。
自然锁表的压力远大于锁行。所以我们应尽量采用锁行。
FOR UPDATE仅适用于InnoDB，且必须在事务处理模块(BEGIN/COMMIT)中才能生效
那么什么时候锁表呢？</p><ul><li>例1: (明确指定主键，并且有此记录，row lock)
SELECT * FROM xxx WHERE id=3 FOR UPDATE;</li><li>例2: (明确指定主键，若查无此记录，无lock)
SELECT * FROM xxx WHERE id=-1 FOR UPDATE;</li><li>例3: (无索引列查询，table lock)
SELECT * FROM xxx WHERE name=&lsquo;xxx&rsquo; FOR UPDATE;</li><li>例4: (主键不明确，table lock)
SELECT * FROM xxx WHERE id &lt;> 3 FOR UPDATE;</li></ul><p>RR模式下实现方式：</p><p>当前读使用next-key锁(行记录锁+Gap间隙锁)实现</p><ul><li><p>对主键或唯一索引，如果当前读时，where条件全部精确命中(=或者in)，这种场景本身就不会出现幻读，所以只会加行记录锁</p></li><li><p>没有索引的列，当前读操作时，会加全表gap锁和记录锁</p></li><li><p>非唯一索引列，则除记录锁外会额外加附近Gap间隙锁</p></li></ul><h3 id=快照读>快照读</h3><p>单纯的select操作(不加锁)，不包括上述 select &mldr; lock in share mode, select &mldr; for update</p><h2 id=一致性视图consistent-read-view>一致性视图(consistent read view)</h2><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/524341-20230407161748862-1610998319-20230413164714328.png alt=img></p><h3 id=定义>定义</h3><p>一致性读视图是InnoDB在实现MVCC用到的虚拟结构，用于读提交（RC）和可重复度（RR）隔离级别的实现。</p><p>一致性视图没有物理结构，主要是在事务执行期间用来定义该事物可以看到什么数据</p><h3 id=获取方式及时机>获取方式及时机</h3><ol><li><p>一致性视图是在第执行第一个<strong>快照读</strong>语句时创建的</p></li><li><p>一致性视图是在执行<code>start transaction with consistent read</code>时创建</p></li></ol><p>在 MySQL 中，READ COMMITTED 和 REPEATABLE READ 隔离级别的区别就是它们生成 ReadView 的时机不同</p><p>读已提交：每次查询重新获取一致性视图</p><p>可重复读：事务第一次查询时获取一致性视图</p><p>对可重复读来说，事务只有在第一次进行读操作时才会生成一个ReadView，后续的读操作都会重复使用这个ReadView。</p><p>也就是说，如果在此期间有其他事务提交了，那么对于可重复读来说也是不可见的，因为对它来说，事务活跃状态在第一次进行读操作时就已经确定下来，后面不会修改了。</p><p>对读已提交来说，事务中的每次读操作都会生成一个新的ReadView。</p><p>也就是说，如果这期间某个未提交事务Commit了，那么它就会从ReadView中移除，添加到已提交事务中，这样确保RC级别下事务每次读操作都能读到已经提交的数据</p><h3 id=工作原理>工作原理</h3><p>事务在正式启动的时候我们会创建一致性视图，该一致性视图是基于整个库的</p><p>InnodDB 的每个事务都有一个唯一的事务 ID，叫做 transaction id，该 ID 在事务开始的时候向 InnoDB 申请，并且按照申请顺序严格递增。</p><p>每行数据都会有多个版本，每次事务更新数据的时候都会生成一个新的数据版本，并且把 transaction id 赋值给这个数据版本的事务 id，称为 row trx_id。</p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/524341-20230407160922386-1923226070.png alt=img></p><p>上图是一条行数据的多个版本，最新的版本是 V4。</p><p>其中 U3、U2、U1 代表的是 undo log，V1、V2、V3 在物理上并不真实存在，而是在需要的时候通过 V4 配合 undo log 计算获得。</p><p>ReadView 中主要包含 4 个比较重要的内容：</p><ul><li>m_ids：表示在生成 ReadView 时当前系统中活跃的读写事务的事务 id 列表。</li><li>min_trx_id：表示在生成 ReadView 时当前系统中活跃的读写事务中最小的事务 id，也就是 m_ids 中的最小值。</li><li>max_trx_id：表示生成 ReadView 时系统中应该分配给下一个事务的 id 值。</li><li>creator_trx_id：表示生成该 ReadView 的事务的事务 id。</li></ul><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/524341-20230407160945189-2030808542.png alt=img></p><p>在访问某条记录时，按照下边的步骤判断记录的某个版本是否可见：</p><ul><li>如果被访问版本的 trx_id 属性值与 ReadView 中的 creator_trx_id 值相同，意味着当前事务在访问它自己修改过的记录，所以该版本可以被当前事务访问。</li><li>如果被访问版本的 trx_id 属性值小于 ReadView 中的 min_trx_id 值，表明生成该版本的事务在当前事务生成 ReadView 前已经提交，所以该版本可以被当前事务访问。</li><li>如果被访问版本的 trx_id 属性值大于 ReadView 中的 max_trx_id 值，表明生成该版本的事务在当前事务生成 ReadView 后才开启，所以该版本不可以被当前事务访问。</li><li>如果被访问版本的 trx_id 属性值在 ReadView 的 min_trx_id 和 max_trx_id 之间，那就需要判断一下 trx_id 属性值是不是在 m_ids 列表中，如果在，说明创建 ReadView 时生成该版本的事务还是活跃的，该版本不可以被访问那就顺着版本链找到下一个版本的数据，继续按照上边的步骤判断可见性，依此类推，直到版本链中的最后一个版本。如果最后一个版本也不可见的话，那么就意味着该条记录对该事务完全不可见，查询结果就不包含该记录；如果不在，说明创建 ReadView 时生成该版本的事务已经被提交，该版本可以被访问</li></ul><p>在 InnoDB 中，为每个事务构造了一个 当前事务 ID 数组的快照，就是记录事务开启时，当前正在执行的事务 ID 的集合。数组里面 trx_id 最小的记为 低水位，trx_id 最大的 + 1 记为高水位。如下图所示：</p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/524341-20230407161039073-1127404762.png alt=img></p><p>对于一个新事务而言，所读取到的记录版本的 trx_id 可能有以下几种情况：</p><ol><li><p>在绿色区域：说明数据版本在事务开始前已提交，当前版本是可见的</p></li><li><p>在红色区域：说明数据版本在事务开始后变更的，当前版本是不可见的</p></li><li><p>在橙色区域：包含 2 种情况</p><ol><li>如果 数据版本的 trx_id 在数组中，说明是正在执行的事务，不可见</li><li>如果 数据版本的 trx_id 不在数组中，说明是已经提交的事务，可见</li></ol></li></ol><p>总之，<strong>一个数据版本，对于一个事务视图来说，除了自己的更新总是可见以外，有三种情况：</strong></p><ol><li>版本未提交，不可见；</li><li>版本已提交，但是是在视图创建后提交的，不可见；</li><li>版本已提交，而且是在视图创建前提交的，可见</li></ol><p><strong>更新数据都是先读后写的，而这个读，只能读当前的值，称为当前读</strong></p><p><strong>可重复读的核心就是一致性读（consistent read）；而事务更新数据的时候，只能用当前读。如果当前的记录的行锁被其他事务占用的话，就需要进入锁等待</strong></p><p>可以看出，InnoDB 利用了 UndoLog 数据多版本的特点，实现了快速创建快照的能力</p><h2 id=事务定义>事务定义</h2><p>事务指作为单个逻辑工作单元执行的一系列操作，这些操作要么全做要么全不做，是一个不可分割的工作单元</p><h2 id=事务特性acid>事务特性：ACID</h2><h3 id=原子性>原子性</h3><p>事务的所有操作要么全部完成，要么全部不完成，不会结束在某个中间状态</p><h3 id=一致性>一致性</h3><p>事务开始之前和事务结束之后，数据库的完整性约束未被破坏</p><h3 id=隔离性>隔离性</h3><p>当多个事务并发访问数据库中同一数据时所表现出来的相互关系</p><h3 id=持久性>持久性</h3><p>事务完成之后，事务所做的修改持久化保存，不会丢失</p><p><img src=https://techzealot.oss-cn-beijing.aliyuncs.com/img/image-20230412142653184.png alt=image-20230412142653184></p><h2 id=事务开启与提交模式>事务开启与提交模式</h2><ul><li>若参数autocommit=0，事务则在用户本次对数据进行操作时自动开启，在用户执行commit命令时提交，用户本次对数据库开始进行操作到用户执行commit命令之间的一系列操作为一个完整的事务周期。若不执行commit命令，系统则默认事务回滚。总而言之，当前情况下事务的状态是自动开启手动提交。</li><li>若参数autocommit=1（系统默认值），事务的开启与提交又分为两种状态：
<strong>①手动开启手动提交</strong>：当用户执行start transaction命令时（事务初始化），一个事务开启，当用户执行commit命令时当前事务提交。从用户执行start transaction命令到用户执行commit命令之间的一系列操作为一个完整的事务周期。若不执行commit命令，系统则默认事务回滚。
<strong>②自动开启自动提交</strong>：如果用户在当前情况下（参数autocommit=1）未执行start transaction命令而对数据库进行了操作，系统则默认用户对数据库的每一个操作为一个孤立的事务，也就是说用户每进行一次操作系都会即时提交或者即时回滚。这种情况下用户的每一个操作都是一个完整的事务周期。</li></ul><h2 id=事务隔离级别>事务隔离级别</h2><table><thead><tr><th style=text-align:center>隔离级别</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td style=text-align:center>读未提交</td><td>可能</td><td>可能</td><td>可能</td></tr><tr><td style=text-align:center>读已提交</td><td>不可能</td><td>可能</td><td>可能</td></tr><tr><td style=text-align:center>可重复读</td><td>不可能</td><td>不可能</td><td>可能</td></tr><tr><td style=text-align:center>串行化</td><td>不可能</td><td>不可能</td><td>不可能</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 查看事务隔离级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>@@</span>transaction_isolation
</span></span><span style=display:flex><span><span style=color:#75715e>-- mysql8 默认REPEATABLE-READ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 数据准备
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>users<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>   <span style=color:#66d9ef>int</span>(<span style=color:#ae81ff>11</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>name<span style=color:#f92672>`</span> <span style=color:#66d9ef>varchar</span>(<span style=color:#ae81ff>30</span>) <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>age<span style=color:#f92672>`</span>  <span style=color:#66d9ef>tinyint</span>(<span style=color:#ae81ff>4</span>) <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>)
</span></span><span style=display:flex><span>) <span style=color:#66d9ef>ENGINE</span><span style=color:#f92672>=</span>InnoDB <span style=color:#66d9ef>AUTO_INCREMENT</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CHARSET</span><span style=color:#f92672>=</span>utf8;
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#a6e22e>users</span>(<span style=color:#f92672>`</span>name<span style=color:#f92672>`</span>, age)
</span></span><span style=display:flex><span><span style=color:#66d9ef>values</span> (<span style=color:#e6db74>&#39;tom&#39;</span>, <span style=color:#ae81ff>15</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;jack&#39;</span>,<span style=color:#ae81ff>20</span>),
</span></span><span style=display:flex><span>       (<span style=color:#e6db74>&#39;zed&#39;</span>,<span style=color:#ae81ff>30</span>);
</span></span></code></pre></div><h3 id=读未提交>读未提交</h3><h4 id=场景>场景</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>shellA<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 设置事务隔离级别为读未提交
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> session transaction isolation level <span style=color:#66d9ef>read</span> uncommitted ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>start transaction ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=&#39;tom&#39;,age = 15)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>shellB<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 设置事务隔离级别为读未提交
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> session transaction isolation level <span style=color:#66d9ef>read</span> uncommitted ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>start transaction ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>update</span> users <span style=color:#66d9ef>set</span> age<span style=color:#f92672>=</span><span style=color:#ae81ff>22</span> <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=&#39;tom&#39;,age = 22)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>shellA<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 脏读
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=&#39;tom&#39;,age = 22)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>shellB<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>rollback ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=&#39;tom&#39;,age = 15)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>shellA<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 不可重复读
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=&#39;tom&#39;,age = 15)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>commit ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=&#39;tom&#39;,age = 15)
</span></span></span></code></pre></div><h4 id=影响>影响</h4><p>会产生脏读、不可重复读、幻读</p><h4 id=脏读>脏读</h4><p>事务A读取到事务B未提交数据，但事务B可能回滚事务，导致事务A读到了脏数据</p><h4 id=实现方式>实现方式</h4><p>mysql采用读不加锁，写加写锁，由于读不加锁，写锁排他性不生效</p><h3 id=读已提交>读已提交</h3><h4 id=场景-1>场景</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>shellA<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 设置事务隔离级别为读已提交
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> session transaction isolation level <span style=color:#66d9ef>read</span> committed ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>start transaction ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=&#39;tom&#39;,age = 15)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>shellB<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 设置事务隔离级别为读已提交
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> session transaction isolation level <span style=color:#66d9ef>read</span> committed ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>start transaction ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>update</span> users <span style=color:#66d9ef>set</span> age<span style=color:#f92672>=</span><span style=color:#ae81ff>22</span> <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=tom,age = 22)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>shellA<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>--  不会产生脏读
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=&#39;tom&#39;,age = 15)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>shellB<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>commit ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=tom,age = 22)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>shellA<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 提交后可读产生不可重复读
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 同一个事务中两次相同查询获取了不同的数据,产生不可重复读问题
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=tom,age = 22)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>commit ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=tom,age = 22)
</span></span></span></code></pre></div><h4 id=影响-1>影响</h4><p>会产生不可重复读、幻读问题</p><h4 id=不可重复读>不可重复读</h4><p>事务A中两次相同查询之间事务B修改并提交了数据导致两次相同的查询在一次事务中获得了不同的结果</p><p>主要针对update和delete</p><h4 id=实现方式-1>实现方式</h4><p>mysql采用MVCC机制，每个select语句有一份自己的快照，而不是一个事务一份快照。</p><h3 id=可重复读>可重复读</h3><h4 id=场景-2>场景</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>shellA<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 设置事务隔离级别为可重复读
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> session transaction isolation level repeatable <span style=color:#66d9ef>read</span> ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>start transaction ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=&#39;tom&#39;,age = 22)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>shellB<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 设置事务隔离级别为可重复读
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> session transaction isolation level repeatable <span style=color:#66d9ef>read</span> ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>start transaction ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>update</span> users <span style=color:#66d9ef>set</span> age<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span> <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=&#39;tom&#39;,age = 33)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> <span style=color:#a6e22e>users</span>(id, name, age) <span style=color:#a6e22e>value</span> (<span style=color:#ae81ff>4</span>,<span style=color:#e6db74>&#39;tim&#39;</span>,<span style=color:#ae81ff>40</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=4,name=&#39;tim&#39;,age = 40)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>shellA<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>--  不会产生脏读，不可重复读
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=&#39;tom&#39;,age = 22)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 不存在id=4的记录
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>shellB<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>commit ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>shellA<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- B提交后仍不可读，解决了不可重复读
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=&#39;tom&#39;,age = 22)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 不存在id=4的记录(mysql的不可重复读实现不能直接复现幻读)
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 执行插入id=4的数据，产生幻读(以为不存在实际存在，间接证明了存在幻读)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> <span style=color:#a6e22e>users</span>(id, name, age) <span style=color:#a6e22e>value</span> (<span style=color:#ae81ff>4</span>,<span style=color:#e6db74>&#39;tim&#39;</span>,<span style=color:#ae81ff>40</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- ERROR 1062 (23000): Duplicate entry &#39;4&#39; for key &#39;users.PRIMARY&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>commit ;
</span></span><span style=display:flex><span><span style=color:#75715e>-- B提交后才可读
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;tom&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=1,name=&#39;tom&#39;,age = 33)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (id=4,name=&#39;tim&#39;,age = 40)
</span></span></span></code></pre></div><p>mysql在可重复读级别下当前读模式已解决幻读问题：</p><p>通过next-key锁阻止其它事务创建满足查询条件的新纪录的方式解决了当前读的幻读问题，但是快照读依然存在幻读问题</p><p>例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>sessionA<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>start transaction;
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> id <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>sessionB<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>start transaction;
</span></span><span style=display:flex><span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> <span style=color:#a6e22e>users</span>(id,name,age) <span style=color:#a6e22e>value</span>(<span style=color:#ae81ff>5</span>,<span style=color:#e6db74>&#39;cat&#39;</span>,<span style=color:#ae81ff>55</span>);
</span></span><span style=display:flex><span>commit;
</span></span><span style=display:flex><span>sessionA<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>update</span> users <span style=color:#66d9ef>set</span> age<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span> <span style=color:#66d9ef>where</span> id <span style=color:#f92672>&gt;</span><span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> id <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 会查出id=5的记录
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>commit;
</span></span></code></pre></div><p>解决方式：</p><p>将快照读转换为当前读</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>sessionA<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>start transaction;
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> id <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>2</span> <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>update</span>;
</span></span><span style=display:flex><span>sessionB<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>start transaction;
</span></span><span style=display:flex><span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> <span style=color:#a6e22e>users</span>(id,name,age) <span style=color:#a6e22e>value</span>(<span style=color:#ae81ff>5</span>,<span style=color:#e6db74>&#39;cat&#39;</span>,<span style=color:#ae81ff>55</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 此时该语句会阻塞直到sessionA事务提交
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>commit;
</span></span><span style=display:flex><span>sessionA<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>update</span> users <span style=color:#66d9ef>set</span> age<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span> <span style=color:#66d9ef>where</span> id <span style=color:#f92672>&gt;</span><span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> users <span style=color:#66d9ef>where</span> id <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 不会查出id=5的记录
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>commit;
</span></span></code></pre></div><h4 id=幻读>幻读</h4><p>同一个事务中第一次查没有数据，第二次查返回了数据，主要针对insert</p><p>针对当前读，<strong>RR隔离级别保证对读取到的记录加锁 (记录锁)，同时保证对读取的范围加锁，新的满足查询条件的记录不能够插入 (间隙锁)</strong>，不存在幻读现象</p><h4 id=实现方式-2>实现方式：</h4><p>mysql采用一个事务一份快照保证了可重复读，并采用next-key锁解决了当前读的幻读问题(与标准有所不同)</p><p>读已提交每次查询创建一个新的快照，可重复读是是一个事务复用一个快照，在首次查询时创建快照</p><h3 id=串行化>串行化</h3><p>将所有事务操作变为顺序执行，后一个事务的执行必须等待前一个事务结束</p><p>实现方式：</p><p>读的时候加共享锁，也就是其他事务可以并发读，但是不能写。写的时候加排它锁，其他事务不能并发写也不能并发读</p><h2 id=事务隔离级别实现原理>事务隔离级别实现原理</h2><h3 id=读未提交-1>读未提交</h3><p>读不加锁，写加X锁，但是由于读不加锁导致写锁排他性无效</p><h3 id=读已提交-1>读已提交</h3><p>通过sql级别一致性视图和record锁</p><h3 id=可重复读-1>可重复读</h3><p>通过事务级别一致性视图和next-key锁</p><h3 id=串行化-1>串行化</h3><p>读加S锁，写加X锁</p><p>参考资料：</p><p><a href=https://learnku.com/articles/68201>对线面试官：MySQL 事务、锁和MVCC</a></p><p><a href=https://zhuanlan.zhihu.com/p/117476959>MySQL事务隔离级别和实现原理</a></p><p><a href=https://www.jianshu.com/p/eb3f56565b42>MySQL-当前读、快照读、MVCC</a></p><p><a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=5#/sale">高性能MySQL实战</a></p><p><a href=https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html>InnoDB Locking</a></p><p><a href=https://time.geekbang.org/column/intro/100020801>MySQL 实战 45 讲</a></p><p><a href=https://learnku.com/articles/67886>对线面试官：通过MVCC数据库事务的一致性</a></p><p><a href=https://www.cnblogs.com/binyue/p/17296542.html>MySQL笔记之一致性视图与MVCC实现</a></p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/%E4%BA%8B%E5%8A%A1/ rel=tag>事务</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E9%94%81/ rel=tag>锁</a></li><li class=tags__item><a class="tags__link btn" href=/tags/mvcc/ rel=tag>MVCC</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E4%B8%80%E8%87%B4%E6%80%A7%E8%A7%86%E5%9B%BE/ rel=tag>一致性视图</a></li></ul></div></footer></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="techzealot avatar" src=/images/avatar.jpg class=avatar height=90 width=90></figure><div class=authorbox__header><span class=authorbox__name>关于 techzealot</span></div><div class=authorbox__description>What I cannot create, I do not understand.</div></div><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/posts/spring%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%E4%B8%8E%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98/ rel=prev><span class=pager__subtitle>«&#8201;上一篇</span><p class=pager__title>Spring循环依赖与三级缓存</p></a></div></nav></div><aside class=sidebar><div class="widget-recent widget"><h4 class=widget__title>近期文章</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/posts/mysql%E4%BA%8B%E5%8A%A1/>Mysql事务</a></li><li class=widget__item><a class=widget__link href=/posts/spring%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%E4%B8%8E%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98/>Spring循环依赖与三级缓存</a></li><li class=widget__item><a class=widget__link href=/posts/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E9%87%8F%E6%B1%A0/>字符串常量池</a></li><li class=widget__item><a class=widget__link href=/posts/spring-aop/>Spring Aop</a></li><li class=widget__item><a class=widget__link href=/posts/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BD%AF%E5%88%A0%E9%99%A4%E8%AE%BE%E8%AE%A1/>数据库软删除设计</a></li><li class=widget__item><a class=widget__link href=/posts/spring%E4%BA%8B%E5%8A%A1/>Spring事务</a></li><li class=widget__item><a class=widget__link href=/posts/sharding-sphere/>sharding sphere</a></li><li class=widget__item><a class=widget__link href=/posts/servicemesh%E6%80%BB%E7%BB%93/>ServiceMesh总结</a></li><li class=widget__item><a class=widget__link href=/posts/docker%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/>Docker知识总结</a></li><li class=widget__item><a class=widget__link href=/posts/k8s%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/>K8S知识总结</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>分类</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/categories/aop/>aop</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/ddd/>DDD</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/docker/>docker</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/hugo/>hugo</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/idea/>idea</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/java/>java</a>&nbsp;
<span class="widget__counter widget__counter--bubble">5</span></li><li class=widget__item><a class=widget__link href=/categories/jcf/>JCF</a>&nbsp;
<span class="widget__counter widget__counter--bubble">4</span></li><li class=widget__item><a class=widget__link href=/categories/k8s/>k8s</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/mermaid/>mermaid</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/mysql/>mysql</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/spring/>spring</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/spring-boot/>spring-boot</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/string/>string</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/%E4%BA%8B%E5%8A%A1/>事务</a>&nbsp;
<span class="widget__counter widget__counter--bubble">2</span></li><li class=widget__item><a class=widget__link href=/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/>分布式事务</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/%E5%AE%B9%E5%99%A8/>容器</a>&nbsp;
<span class="widget__counter widget__counter--bubble">2</span></li><li class=widget__item><a class=widget__link href=/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/>数据库</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC/>服务网格</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/>知识体系</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/%E9%94%81/>锁</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>标签</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=/tags/aop/ title=aop>aop (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/arraydeque/ title=ArrayDeque>ArrayDeque (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/arraylist/ title=ArrayList>ArrayList (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/aspectj/ title=aspectj>aspectj (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/cglib/ title=cglib>cglib (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/coverage/ title=coverage>coverage (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/ddd/ title=DDD>DDD (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/docker/ title=docker>docker (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/hugo/ title=hugo>hugo (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/idea/ title=idea>idea (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/intern/ title=intern>intern (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/ioc/ title=IOC>IOC (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/k8s/ title=k8s>k8s (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/lazy/ title=@Lazy>@Lazy (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/linkedlist/ title=LinkedList>LinkedList (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/mermaid/ title=mermaid>mermaid (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/mvcc/ title=MVCC>MVCC (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/mysql/ title=MySQL>MySQL (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/priorityqueue/ title=PriorityQueue>PriorityQueue (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/seata/ title=seata>seata (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/spring/ title=spring>spring (3)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/spring-boot/ title=spring-boot>spring-boot (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/test/ title=test>test (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E4%B8%80%E8%87%B4%E6%80%A7%E8%A7%86%E5%9B%BE/ title=一致性视图>一致性视图 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E4%BA%8B%E5%8A%A1/ title=事务>事务 (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/ title=分布式事务>分布式事务 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E9%87%8F%E6%B1%A0/ title=字符串常量池>字符串常量池 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/ title=循环依赖>循环依赖 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ title=微服务>微服务 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%9C%80%E5%B0%8F%E5%A0%86/ title=最小堆>最小堆 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7/ title=最终一致性>最终一致性 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC/ title=服务网格>服务网格 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/ title=知识体系>知识体系 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E8%BD%AF%E5%88%A0%E9%99%A4/ title=软删除>软删除 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E9%94%81/ title=锁>锁 (1)</a></div></div><div class="widget-social widget"><h4 class="widget-social__title widget__title">社交</h4><div class="widget-social__content widget__content"><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=GitHub rel="noopener noreferrer" href=https://github.com/techzealot target=_blank><svg class="widget-social__link-icon icon icon-github" width="24" height="24" viewBox="0 0 384 374"><path d="m192 0C85.9.0.0 85.8.0 191.7c0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2.0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8.0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7.0.0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4.0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5.0 25.6-.2 46.3-.2 52.6.0 5.1 3.5 11.1 13.2 9.2C329 348.2 384 276.4 384 191.7 384 85.8 298 0 192 0z"/></svg><span>GitHub</span></a></div><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=Email href=mailto:techzealot@foxmail.com><svg class="widget-social__link-icon icon icon-mail" width="24" height="24" viewBox="0 0 416 288"><path d="m0 16v256 16h16 384 16v-16V16 0h-16H16 0zm347 16-139 92.5L69 32zM199 157.5l9 5.5 9-5.5L384 46v210H32V46z"/></svg><span>techzealot@foxmail.com</span></a></div></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2023 个人博客.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> 主题</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>